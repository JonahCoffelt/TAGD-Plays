<!DOCTYPE html>
<html>
<head>
    <title>Web Controller</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="controller-pad">
        <div class="button-layout">
            <button class="button up" id="btn-up" data-button="up">▲</button>
            <button class="button left" id="btn-left" data-button="left">◀</button>
            <button class="button right" id="btn-right" data-button="right">▶</button>
            <button class="button down" id="btn-down" data-button="down">▼</button>
        </div>
        <div class="button-layout">
            <button class="button up" id="btn-x" data-button="x">X</button>
            <button class="button left" id="btn-y" data-button="y">Y</button>
            <button class="button right" id="btn-a" data-button="a">A</button>
            <button class="button down" id="btn-b" data-button="b">B</button>
        </div>
    </div>
<script>
    let playerTeam = null;
    let serverSessionId = null;

    // disable buttons until assigned
    document.querySelectorAll('button').forEach(btn => btn.disabled = true);

    function enableButtons() {
        document.querySelectorAll('button').forEach(btn => btn.disabled = false);
    }

    // Check if we have saved assignment
    const savedData = JSON.parse(localStorage.getItem("playerData") || "null");

    // Ask server for team + session info
    fetch('/assign-team')
        .then(res => res.json())
        .then(data => {
            serverSessionId = data.sessionId;

            if (savedData && savedData.sessionId === serverSessionId) {
                // Reuse saved team if sessionId matches
                playerTeam = savedData.team;
                console.log("Restored Team:", playerTeam);
            } else {
                // Use server's assignment, and save it
                playerTeam = data.team;
                localStorage.setItem("playerData", JSON.stringify({
                    team: playerTeam,
                    sessionId: serverSessionId
                }));
                console.log("Assigned new Team:", playerTeam);
            }
            enableButtons();
        });

    // Button press handler
    document.querySelectorAll('button').forEach(button => {
        button.addEventListener('click', () => {
            if (!playerTeam) return;
            const buttonName = button.dataset.button;
            fetch('/button-press', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ button: buttonName, team: playerTeam })
            });
        });
    });
</script>


</body>
</html>