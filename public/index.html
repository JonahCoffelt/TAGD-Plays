<!DOCTYPE html>
<html>
<head>
    <title>Web Controller</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="controller-pad">
        <div class="button-layout">
            <button class="button up" id="btn-up" data-button="up">▲</button>
            <button class="button left" id="btn-left" data-button="left">◀</button>
            <button class="button right" id="btn-right" data-button="right">▶</button>
            <button class="button down" id="btn-down" data-button="down">▼</button>
        </div>
        <div class="button-layout">
            <button class="button up" id="btn-x" data-button="x">X</button>
            <button class="button left" id="btn-y" data-button="y">Y</button>
            <button class="button right" id="btn-a" data-button="a">A</button>
            <button class="button down" id="btn-b" data-button="b">B</button>
        </div>
    </div>
    <script>
    let playerTeam = localStorage.getItem("playerTeam");

    // disable buttons until assigned
    document.querySelectorAll('button').forEach(btn => btn.disabled = true);

    function enableButtons() {
        document.querySelectorAll('button').forEach(btn => btn.disabled = false);
    }

    if (playerTeam) {
        console.log("Restored Team from storage:", playerTeam);
        enableButtons();
    } else {
        // No team yet → ask server for one
        fetch('/assign-team')
            .then(res => res.json())
            .then(data => {
                playerTeam = data.team;
                localStorage.setItem("playerTeam", playerTeam);
                console.log("Assigned to Team", playerTeam);
                enableButtons();
            });
    }

    // Always send team with button press
    document.querySelectorAll('button').forEach(button => {
        button.addEventListener('click', () => {
            if (!playerTeam) return;
            const buttonName = button.dataset.button;
            fetch('/button-press', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ button: buttonName, team: playerTeam })
            });
        });
    });
</script>

</body>
</html>